{"version":3,"sources":["../../../projects/ng-poppy/src/lib/popover/popover.token.ts","../../../projects/ng-poppy/src/lib/layer/layer.token.ts","../../../projects/ng-poppy/src/lib/layer/layer.component.ts","../../../projects/ng-poppy/src/lib/layer/layer.service.ts","../../../projects/ng-poppy/src/lib/popover/models/popover-active.model.ts","../../../projects/ng-poppy/src/lib/layer/layer.model.ts","../../../projects/ng-poppy/src/lib/popover/services/events.service.ts","../../../projects/ng-poppy/src/lib/popover/services/popover.service.ts","../../../projects/ng-poppy/src/lib/popover/models/popover-append-options.model.ts","../../../projects/ng-poppy/src/lib/popover/popover.animations.ts","../../../projects/ng-poppy/src/lib/popover/models/popover-styles.model.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-menu-item.directive.ts","../../../projects/ng-poppy/src/lib/popover/components/popover-menu/popover-menu.component.ts","../../../projects/ng-poppy/src/lib/popover/components/popover-content/popover-content.component.ts","../../../projects/ng-poppy/src/lib/layer/layer.module.ts","../../../node_modules/tslib/tslib.es6.js","../../../projects/ng-poppy/src/lib/popover/directives/base-popover.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-chip.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-chip-remove.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-menu.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-option.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/popover-remove-on-click.directive.ts","../../../projects/ng-poppy/src/lib/popover/directives/tooltip.directive.ts","../../../projects/ng-poppy/src/lib/popover/components/popover-select/popover-select.component.ts","../../../projects/ng-poppy/src/lib/popover/popover.module.ts"],"names":["POPOVER_CONFIG","InjectionToken","LAYER_CONFIG","LayerComponent","config","this","Object","defineProperty","prototype","overlay","Component","args","selector","template","encapsulation","ViewEncapsulation","None","Inject","ViewChild","read","ViewContainerRef","HostBinding","LayerService","componentFactoryResolver","appRef","activeLayers","appendToBody","component","options","injector","componentRef","resolveComponentFactory","create","Injector","provide","useValue","changeDetectorRef","detectChanges","appendComponentFactory","appendComponentRef","instance","container","createComponent","push","ref","attachView","hostView","domElem","rootNodes","document","body","appendChild","removeFromBody","_this","filter","layer","forEach","delayClose","setTimeout","removeLayer","detachView","destroy","Injectable","providedIn","ComponentFactoryResolver","ApplicationRef","ActivePopover","popoverRef","parentPopoverRef","superParentPopoverRef","directiveRef","type","deepLevel","isMenuParent","isSubmenu","isSuperparent","LayerAppendOptions","Number","isInteger","PopoverEventsService","ngZone","registeredEvents","register","activePopover","callback","sub","runOutsideAngular","obs","getEventObservable","subscribe","event","popover","unregister","unsubscribe","_a","closed","e","merge","fromEvent","pipe","tap","window","NgZone","PopoverService","layerService","eventsService","activePopovers","append","directive","existedPopover","find","closeOnTriggerAgain","remove","active","p","popoverComponentRef","afterClose","emit","a","removeByNativeElementRef","element","location","nativeElement","getActive","isPopoverSubmenuExits","precendingRef","parentRef","precendingActivePopover","removeAllNestedPopovers","removeMenu","subscribeToClickOutsideEventForParentPopover","currentPopover","parentPopover_1","layerOptions","PopoverContentComponent","prepareSuperparentAndDeepLevel","superparent","newPopover","afterShow","canRegisterScrollCaptureEvent","registerScrollCaptureEvent","canRegisterResizeEvent","registerResizeEvent","parentPopover","parentPopover_2","contains","hostElement","closestParent_1","popoverGroup","length","triggeredBy","closeOnScroll","hideGroup","updateGroupPosition","captured","target","hideOnScroll","componentStyles","update","PopoverAppendOptions","undefined","fadeInAnimation","trigger","state","style","transform","opacity","transition","animate","SPACE_FROM_TOP","POSITION_MEASURE_UNIT","PopoverStyles","initHostElementWidth","popoverConfig","init","hostBounds","bounds","zIndex","setPositionStyle","top","height","isContextType","isSubmenuType","minWidth","width","triggerBounds","submenuTriggeredItem","getBoundingClientRect","canAssignPadding","padding","isTooltip","popoverWrapperEl","visibility","offsetWidth","setLeftPosition","setTopPosition","setWidth","windowHeight","innerHeight","elementHeight","triggerElement","triggerDirective","hostTopPosition","querySelector","hostPosition","diff","windowWidth","innerWidth","elementWidth","left","defaultLeftPosition","right","hostBounds_1","hostElBounds","isMenuType","property","value","content","PopoverMenuItemDirective","selected","hidden","clicked","EventEmitter","ngOnInit","clicked$","hovered$","ngAfterViewInit","classList","add","Directive","ElementRef","Input","Output","exportAs","changeDetection","ChangeDetectionStrategy","OnPush","ContentChildren","TemplateRef","popoverService","popoverEventsService","cdr","animationState","animationEnd$","Subject","menuItemsChanged","destroy$","applyStyles","innerClass","listenForMouseEventOnHost","canListenForClickOutside","listenForClickOutside","menuRef","menuItems","listenForMenuItemTriggers","changes","takeUntil","next","ngOnDestroy","complete","templateRef","animationEnd","toState","onClickMenuItem","item","submenu","closeOnClickItem","close","onHoverMenuItem","canRemoveNestedSubmenus","hasItemNestedSubpopovers","createSubpopover","clickedElement","clickedOutside","enteredPopover","index","debounceTime","skipUntil","isMenu","providedValues","PopoverMenuComponent","subMenuComponentRef","closeOnClickOutside","destroyed","animations","ChangeDetectorRef","NgModule","declarations","imports","CommonModule","extendStatics","d","b","setPrototypeOf","__proto__","Array","hasOwnProperty","call","__extends","__","constructor","__read","o","n","m","Symbol","iterator","r","i","ar","done","error","BasePopoverDirective","setOptions","appendToLayer","getPopoverComponentInjector","opts","assign","run","PopoverDirective","_super","poppyPopover","listenEventsForClickTrigger","listenEventsForHoverTrigger","open","canAppend","providerValues","popoverHovered","hostHovered","isMouseLeftBeforeDelayTimePast","switchMap","timer","isHostElementStillInDOM","take","PopoverChipRemoveDirective","selectComponentRef","onClick","closeChip","poppyChipRemove","PopoverSelectComponent","HostListener","PopoverMenuDirective","poppyMenu","listenEventsForContextTrigger","updateContentPosition","getBounds","preventDefault","contextMenuPosition","clientY","clientX","PopoverRemoveOnClickDirective","host","parentElement","closest","TooltipDirective","poppyTooltip","controlContainer","bindLabel","multiselect","clearable","searchable","placeholder","notFoundText","changed","selectedOptions","displayedOptions","displayedChips","asyncLoading","isMenuOpen","propagateChange","ngOnChanges","previousValue","currentValue","onOptionsChange","writeValue","onCloseMenu","async","loadAsyncOptions","firstLoad","onInputKeyUp","every","opt","updateSelectedItemsForMultiSelection","updateSelectedItemsForSingleSelection","reset","registerOnChange","fn","registerOnTouched","setDisabledState","isDisabled","getDisplayLabel","option","onClickItem","clickedOption","matchByValueOrReference","updateDisplayedChips","inputEl","emitChange","onChangeInput","includes","clear","stopPropagation","getDisplayValue","chip","arguments","concat","__spread","map","getPropagateValue","bindValue","searchPhrase","results","isArray","Error","v","findIndex","splice","comparedTo","providers","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","NG_VALIDATORS","ControlContainer","decorators","Optional","Host","SkipSelf","ContentChild","PopoverChipDirective","PopoverOptionDirective","BrowserAnimationsModule","LayerModule","exports"],"mappings":"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","sourcesContent":["import { ElementRef, InjectionToken, TemplateRef } from '@angular/core';\n\nimport {PopoverBounds, PopoverMenu, PopoverTrigger, PopoverType} from './popover.interface';\nimport { BasePopoverDirective } from './directives/base-popover';\nimport { PopoverMenuItemDirective } from './directives/popover-menu-item.directive';\nimport { PopoverMenuComponent } from './components/popover-menu/popover-menu.component';\n\nexport const POPOVER_CONFIG = new InjectionToken<PopoverConfig>('popover-config');\n\nexport interface PopoverConfig {\n  bounds: PopoverBounds;\n  type: PopoverType;\n  triggerDirective?: BasePopoverDirective;\n  content?: TemplateRef<any> | string;\n  trigger?: PopoverTrigger;\n  triggerElement?: ElementRef;\n  menuItems?: PopoverMenu;\n  menuRef?: PopoverMenuComponent;\n  styles?: { [key: string]: number | string };\n  submenuTriggeredItem?: PopoverMenuItemDirective;\n  multiselect?: boolean;\n  closeOnClickOutside?: boolean;\n  closeOnClickItem?: boolean;\n  selectable?: boolean;\n  innerClass?: string;\n}\n","import { InjectionToken } from '@angular/core';\n\nexport const LAYER_CONFIG = new InjectionToken<LayerConfig>('layer-token');\n\nexport interface LayerConfig {\n  overlay?: boolean;\n}\n","import {\n  Component,\n  HostBinding,\n  Inject,\n  ViewChild,\n  ViewContainerRef,\n  ViewEncapsulation\n} from '@angular/core';\n\nimport { LAYER_CONFIG, LayerConfig } from './layer.token';\n\n@Component({\n  // tslint:disable-next-line:component-selector\n  selector: 'poppy-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n})\nexport class LayerComponent {\n  @ViewChild('container', { read: ViewContainerRef}) container: ViewContainerRef;\n\n  constructor(@Inject(LAYER_CONFIG) private config: LayerConfig) {}\n\n  @HostBinding('class.poppy-layer--overlay') get overlay(): boolean {\n    return this.config.overlay;\n  }\n}\n","import {\n  ApplicationRef,\n  ComponentFactoryResolver,\n  ComponentRef,\n  EmbeddedViewRef,\n  Injectable,\n  Injector,\n  Type,\n} from '@angular/core';\nimport { LayerComponent } from './layer.component';\nimport { ActiveLayer } from './layer.interface';\nimport { LayerAppendOptions } from './layer.model';\nimport { LAYER_CONFIG } from './layer.token';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LayerService {\n  private activeLayers: ActiveLayer<any>[] = [];\n\n  constructor(\n    private readonly componentFactoryResolver: ComponentFactoryResolver,\n    private readonly appRef: ApplicationRef\n  ) {}\n\n  appendToBody<T>(component: Type<T>, options: LayerAppendOptions, injector?): ComponentRef<T> {\n    const componentFactory = this.componentFactoryResolver.resolveComponentFactory(LayerComponent);\n    const componentRef = componentFactory.create(\n      Injector.create([\n        {\n          provide: LAYER_CONFIG,\n          useValue: options,\n        },\n      ])\n    );\n\n    componentRef.changeDetectorRef.detectChanges();\n\n    const appendComponentFactory = this.componentFactoryResolver.resolveComponentFactory(component);\n    const appendComponentRef = componentRef.instance.container.createComponent(\n      appendComponentFactory,\n      null,\n      injector\n    );\n\n    this.activeLayers.push({\n      ref: componentRef,\n      appendComponentRef,\n      options,\n    });\n\n    this.appRef.attachView(componentRef.hostView);\n    const domElem = (componentRef.hostView as EmbeddedViewRef<unknown>).rootNodes[0] as HTMLElement;\n    document.body.appendChild(domElem);\n\n    return appendComponentRef;\n  }\n\n  removeFromBody<T>(componentRef: ComponentRef<T>): void {\n    const layers = this.activeLayers.filter((layer) => layer.appendComponentRef === componentRef);\n\n    layers.forEach((layer) => {\n      const delayClose = layer.options.delayClose;\n      if (delayClose !== null) {\n        setTimeout(() => {\n          this.removeLayer<T>(layer);\n        }, delayClose);\n      } else {\n        this.removeLayer<T>(layer);\n      }\n    });\n\n    this.activeLayers = this.activeLayers.filter((layer) => layer.appendComponentRef !== componentRef);\n  }\n\n  private removeLayer<T>(layer: ActiveLayer<T>): void {\n    this.appRef.detachView(layer.ref.hostView);\n    layer.ref.changeDetectorRef.detectChanges();\n    layer.ref.destroy();\n  }\n}\n","import { ComponentRef } from '@angular/core';\n\nimport { PopoverType } from '../popover.interface';\nimport { PopoverContentComponent } from '../components/popover-content/popover-content.component';\nimport { BasePopoverDirective } from '../directives/base-popover';\n\nexport class ActivePopover {\n  isMenuParent: boolean;\n  isSuperparent: boolean;\n  isSubmenu: boolean;\n\n  constructor(\n    public popoverRef: ComponentRef<PopoverContentComponent>,\n    public parentPopoverRef: ComponentRef<PopoverContentComponent>,\n    public superParentPopoverRef: ComponentRef<PopoverContentComponent>,\n    public directiveRef: BasePopoverDirective,\n    public type: PopoverType,\n    public deepLevel: number\n  ) {\n    this.isMenuParent = type === 'menu';\n    this.isSubmenu = type === 'submenu';\n    this.isSuperparent = this.popoverRef === this.superParentPopoverRef;\n  }\n}\n","import { ILayerAppendOptions } from './layer.interface';\n\nexport class LayerAppendOptions {\n  delayClose: number;\n  overlay: boolean;\n\n  constructor(options: ILayerAppendOptions = {}) {\n    this.delayClose = Number.isInteger(options.delayClose) ? options.delayClose : null;\n    this.overlay = !!options.overlay;\n  }\n}\n","import { Injectable, NgZone } from '@angular/core';\nimport { IPopoverEventService } from '../popover.interface';\nimport { Subscription, Observable, merge, fromEvent } from 'rxjs';\nimport { ActivePopover } from '../models/popover-active.model';\nimport { tap } from 'rxjs/operators';\n\nexport type PopoverEventType = 'click-outside' | 'resize' | 'capture-scroll';\n\ninterface PopoverRegisteredEvent {\n  sub: Subscription;\n  popover: ActivePopover;\n  type: PopoverEventType;\n  callback?: (args?) => void | any;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class PopoverEventsService implements IPopoverEventService {\n  private registeredEvents: PopoverRegisteredEvent[] = [];\n\n  constructor(private ngZone: NgZone) {}\n\n  register(\n    type: PopoverEventType,\n    activePopover: ActivePopover,\n    callback: (event: Event) => void | any\n  ): void {\n    let sub: Subscription;\n\n    this.ngZone.runOutsideAngular(() => {\n      const obs: Observable<Event> = this.getEventObservable(type);\n      sub = obs.subscribe((event) => {\n        callback(event);\n      });\n    });\n\n    this.registeredEvents.push({ popover: activePopover, type, sub, callback });\n  }\n\n  unregister(type: PopoverEventType, activePopover: ActivePopover): void {\n    this.registeredEvents\n      .filter((event) => event.type === type)\n      .forEach((event) => {\n        if (event.popover === activePopover) {\n          event.sub.unsubscribe();\n        }\n      });\n    this.registeredEvents = this.registeredEvents.filter((event) =>\n      event.type === type ? event.popover !== activePopover : true\n    );\n  }\n\n  subscribe(type: PopoverEventType, popover: ActivePopover): void {\n    const obs: Observable<Event> = this.getEventObservable(type);\n\n    this.registeredEvents\n      .filter((event) => event.type === type && event.popover === popover && event.sub?.closed)\n      .forEach((event) => {\n        event.sub = obs.subscribe((e) => event.callback(e));\n      });\n  }\n\n  unsubscribe(type: PopoverEventType, popover: ActivePopover): void {\n    this.registeredEvents\n      .filter((event) => event.type === type && event.popover === popover)\n      .forEach((event) => {\n        event.sub.unsubscribe();\n      });\n  }\n\n  private getEventObservable(type: PopoverEventType): Observable<Event> {\n    switch (type) {\n      case 'click-outside':\n        return merge(fromEvent(document, 'click'), fromEvent(document, 'contextmenu'))\n          .pipe\n          // tap(() => console.log('listen for click outside..'))\n          ();\n      case 'capture-scroll':\n        return fromEvent<MouseEvent>(document, 'scroll').pipe(\n          tap(() => {\n            // console.log('Capturing scroll event..');\n          })\n        );\n      case 'resize':\n        return fromEvent<MouseEvent>(window, 'resize').pipe(\n          tap(() => {\n            // console.log('Resize event..');\n          })\n        );\n    }\n  }\n}\n","import { ComponentRef, Injectable, Injector } from '@angular/core';\n\nimport { PopoverContentComponent } from '../components/popover-content/popover-content.component';\nimport { LayerService } from '../../layer/layer.service';\nimport { PopoverAppendOptions } from '../models/popover-append-options.model';\nimport { ActivePopover } from '../models/popover-active.model';\nimport { BasePopoverDirective } from '../directives/base-popover';\nimport { LayerAppendOptions } from '../../layer/layer.model';\nimport { PopoverEventsService } from './events.service';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class PopoverService {\n  activePopovers: ActivePopover[] = [];\n\n  constructor(private layerService: LayerService, private eventsService: PopoverEventsService) {}\n\n  append(\n    injector: Injector,\n    directive: BasePopoverDirective,\n    options: PopoverAppendOptions,\n    parentPopoverRef?: ComponentRef<PopoverContentComponent>\n  ): ComponentRef<PopoverContentComponent> {\n    const existedPopover = this.activePopovers.find((popover) => popover.directiveRef === directive);\n\n    if (options.closeOnTriggerAgain && existedPopover) {\n      this.remove(existedPopover.popoverRef);\n      return existedPopover.popoverRef;\n    } else {\n      return this.appendToBody(injector, directive, options, parentPopoverRef);\n    }\n  }\n\n  remove(popoverRef: ComponentRef<PopoverContentComponent>): void {\n    const active: ActivePopover = this.activePopovers.find((p) => p.popoverRef === popoverRef);\n\n    if (active) {\n      if (active.directiveRef) {\n        active.directiveRef.popoverComponentRef = null;\n        active.directiveRef.afterClose.emit();\n      }\n      active.popoverRef.destroy();\n      this.layerService.removeFromBody(active.popoverRef);\n      this.eventsService.unregister('click-outside', active);\n      this.eventsService.unregister('capture-scroll', active);\n      this.eventsService.unregister('resize', active);\n\n      this.activePopovers = this.activePopovers.filter((a) => a.popoverRef !== popoverRef);\n    }\n  }\n\n  removeByNativeElementRef(element: HTMLElement): void {\n    const activePopover = this.activePopovers.find(\n      (active) => active.popoverRef.location.nativeElement === element\n    );\n\n    if (activePopover) {\n      this.remove(activePopover.popoverRef);\n    }\n  }\n\n  getActive(popoverRef: ComponentRef<PopoverContentComponent>): ActivePopover {\n    return this.activePopovers.find((active) => active.popoverRef === popoverRef);\n  }\n\n  isPopoverSubmenuExits(\n    precendingRef: ComponentRef<PopoverContentComponent>,\n    parentRef: ComponentRef<PopoverContentComponent>\n  ): boolean {\n    const precendingActivePopover: ActivePopover = this.getActive(precendingRef);\n\n    if (!precendingActivePopover || (precendingActivePopover && !precendingActivePopover.deepLevel)) {\n      return false;\n    }\n\n    return !!this.activePopovers.find(\n      (popover) =>\n        popover.parentPopoverRef === parentRef && popover.deepLevel === precendingActivePopover.deepLevel + 1\n    );\n  }\n\n  removeAllNestedPopovers(popoverRef: ComponentRef<PopoverContentComponent>): void {\n    const activePopover = this.getActive(popoverRef);\n\n    if (activePopover) {\n      this.activePopovers\n        .filter((popover) => popover.deepLevel > activePopover.deepLevel)\n        .forEach((popover) => {\n          this.remove(popover.popoverRef);\n        });\n    }\n  }\n\n  removeMenu(componentRef: ComponentRef<PopoverContentComponent>): void {\n    this.activePopovers\n      .filter((popover) => popover.parentPopoverRef === componentRef || popover.popoverRef === componentRef)\n      .forEach((popover) => {\n        this.remove(popover.popoverRef);\n      });\n  }\n\n  subscribeToClickOutsideEventForParentPopover(componentRef: ComponentRef<PopoverContentComponent>): void {\n    const currentPopover: ActivePopover = this.getActive(componentRef);\n\n    if (currentPopover) {\n      const parentPopover: ActivePopover = this.activePopovers.find(\n        (popover) =>\n          popover.superParentPopoverRef === currentPopover.superParentPopoverRef &&\n          popover.deepLevel === currentPopover.deepLevel - 1\n      );\n\n      if (parentPopover) {\n        setTimeout(() => {\n          this.eventsService.subscribe('click-outside', parentPopover);\n        });\n      }\n    }\n  }\n\n  private appendToBody(\n    injector: Injector,\n    directive: BasePopoverDirective,\n    options: PopoverAppendOptions,\n    parentPopoverRef?: ComponentRef<PopoverContentComponent>\n  ): ComponentRef<PopoverContentComponent> {\n    const layerOptions = new LayerAppendOptions({ delayClose: options.delayClose });\n    const popover = this.layerService.appendToBody(PopoverContentComponent, layerOptions, injector);\n    const { superparent, deepLevel } = this.prepareSuperparentAndDeepLevel(\n      popover,\n      parentPopoverRef,\n      directive\n    );\n    const newPopover = new ActivePopover(\n      popover,\n      parentPopoverRef,\n      superparent,\n      directive,\n      options.type,\n      deepLevel\n    );\n\n    popover.instance.componentRef = popover;\n    popover.instance.parentPopoverRef = popover;\n    popover.changeDetectorRef.detectChanges();\n\n    this.activePopovers.push(newPopover);\n\n    if (newPopover.directiveRef) {\n      newPopover.directiveRef.afterShow.emit();\n    }\n\n    if (this.canRegisterScrollCaptureEvent(newPopover, options)) {\n      this.registerScrollCaptureEvent(newPopover, options);\n    }\n\n    if (this.canRegisterResizeEvent(newPopover, options)) {\n      this.registerResizeEvent(newPopover, options);\n    }\n\n    return popover;\n  }\n\n  private prepareSuperparentAndDeepLevel(\n    popover: ComponentRef<PopoverContentComponent>,\n    parentPopover: ComponentRef<PopoverContentComponent>,\n    directive: BasePopoverDirective\n  ): { deepLevel: number; superparent: ComponentRef<PopoverContentComponent> } {\n    let deepLevel = 0;\n    let superparent = null;\n\n    if (directive) {\n      const parentPopover = this.activePopovers.find((p) => {\n        return p.popoverRef.instance.element.nativeElement.contains(directive.hostElement.nativeElement);\n      });\n\n      if (!parentPopover) {\n        superparent = popover;\n        deepLevel = 0;\n      } else {\n        superparent = parentPopover.superParentPopoverRef || parentPopover.popoverRef;\n        deepLevel = parentPopover.deepLevel + 1;\n      }\n    } else {\n      const closestParent = this.activePopovers.find((p) => p.popoverRef === parentPopover);\n      if (closestParent) {\n        const popoverGroup = this.activePopovers.filter(\n          (p) => p.superParentPopoverRef === closestParent.superParentPopoverRef\n        );\n        superparent = closestParent.superParentPopoverRef;\n        deepLevel = popoverGroup[popoverGroup.length - 1].deepLevel + 1;\n      }\n    }\n\n    return {\n      deepLevel,\n      superparent,\n    };\n  }\n\n  private canRegisterScrollCaptureEvent(popover: ActivePopover, options: PopoverAppendOptions): boolean {\n    const { triggeredBy, type, closeOnScroll } = options;\n\n    return (\n      popover.directiveRef &&\n      popover.deepLevel === 0 &&\n      triggeredBy !== 'hover' &&\n      type !== 'submenu' &&\n      closeOnScroll\n    );\n  }\n\n  private canRegisterResizeEvent(popover: ActivePopover, options: PopoverAppendOptions): boolean {\n    const { triggeredBy, type } = options;\n\n    return popover.directiveRef && popover.deepLevel === 0 && triggeredBy !== 'hover' && type !== 'submenu';\n  }\n\n  private registerResizeEvent(popover: ActivePopover, options: PopoverAppendOptions): void {\n    this.eventsService.register('resize', popover, () => {\n      if (options.type === 'context') {\n        this.hideGroup(popover);\n      } else {\n        this.updateGroupPosition(popover);\n      }\n    });\n  }\n\n  private registerScrollCaptureEvent(popover: ActivePopover, options: PopoverAppendOptions): void {\n    this.eventsService.register('capture-scroll', popover, (event: MouseEvent) => {\n      const captured =\n        popover.directiveRef.hostElement.nativeElement === event.target ||\n        (event.target as HTMLElement).contains(popover.directiveRef.hostElement.nativeElement);\n\n      if ((captured && options.hideOnScroll) || options.type === 'context') {\n        this.hideGroup(popover);\n      }\n\n      if (captured && !options.hideOnScroll && options.type !== 'context') {\n        this.updateGroupPosition(popover);\n      }\n    });\n  }\n\n  private hideGroup(popover: ActivePopover): void {\n    this.activePopovers.forEach((active) => {\n      if (active.superParentPopoverRef === popover.superParentPopoverRef) {\n        this.remove(active.popoverRef);\n      }\n    });\n  }\n\n  private updateGroupPosition(popover: ActivePopover): void {\n    this.activePopovers\n      .filter((active) => active.superParentPopoverRef === popover.popoverRef)\n      .forEach((active) => {\n        if (active.popoverRef.instance.componentStyles) {\n          active.popoverRef.instance.componentStyles.update();\n        }\n      });\n  }\n}\n","import { IPopoverAppendOptions, PopoverTrigger, PopoverType } from '../popover.interface';\n\nexport class PopoverAppendOptions {\n  type: PopoverType;\n  triggeredBy: PopoverTrigger;\n  closeOnScroll: boolean;\n  delayClose: number;\n  closeOnTriggerAgain: boolean;\n  hideOnScroll: boolean;\n\n  constructor(options: IPopoverAppendOptions) {\n    this.type = options.type;\n    this.triggeredBy = options.triggeredBy || 'click';\n    this.closeOnScroll = options.closeOnScroll !== undefined ? options.closeOnScroll : true;\n    this.delayClose = Number.isInteger(options.delayClose) ? options.delayClose : null;\n    this.closeOnTriggerAgain = !!options.closeOnTriggerAgain;\n    this.hideOnScroll = !!options.hideOnScroll;\n  }\n}\n","import { animate, state, style, transition, trigger } from '@angular/animations';\n\nexport const fadeInAnimation = trigger('fadeIn', [\n  state(\n    'open',\n    style({\n      transform: 'translateY(0px)',\n      opacity: 1,\n    })\n  ),\n  state(\n    'close',\n    style({\n      transform: 'translateY(-6px)',\n      opacity: 0.5,\n    })\n  ),\n  transition('close => open', [animate('0.15s')]),\n]);\n","import { ElementRef } from '@angular/core';\nimport { PopoverConfig } from '../popover.token';\nimport { PopoverType } from '../popover.interface';\nimport { PopoverContentComponent } from '../components/popover-content/popover-content.component';\n\nconst SPACE_FROM_BOTTOM = 20;\nconst SPACE_FROM_TOP = 10;\nconst POSITION_MEASURE_UNIT = 'px';\n\nexport class PopoverStyles {\n  private popover: PopoverContentComponent;\n  private hostElement: ElementRef<any>;\n  private config: PopoverConfig;\n  private type: PopoverType;\n  private initHostElementWidth: number = 0;\n\n  constructor(popover: PopoverContentComponent) {\n    this.popover = popover;\n    this.hostElement = popover.element;\n    this.config = popover.popoverConfig;\n    this.type = this.config.type;\n  }\n\n  init(): void {\n    const hostBounds = this.config.bounds;\n\n    this.hostElement.nativeElement.style.zIndex = 10000;\n\n    this.setPositionStyle('left', 0);\n    this.setPositionStyle('top', +hostBounds.top + hostBounds.height + SPACE_FROM_TOP);\n\n    if (!this.isContextType && !this.isSubmenuType) {\n      this.hostElement.nativeElement.style.minWidth = hostBounds.width + 'px';\n    }\n\n    if (this.isContextType) {\n      this.setPositionStyle('top', +hostBounds.top);\n      this.hostElement.nativeElement.style.minWidth = 0;\n    }\n\n    if (this.isSubmenuType) {\n      const triggerItem = this.config.submenuTriggeredItem.element.nativeElement;\n      const triggerBounds: ClientRect = triggerItem.getBoundingClientRect();\n\n      this.hostElement.nativeElement.style.minWidth = 0;\n      this.setPositionStyle('top', triggerBounds.top);\n    }\n\n    if (this.canAssignPadding) {\n      const padding = this.isTooltip ? '8px 12px' : '15px 25px';\n      this.popover.popoverWrapperEl.nativeElement.style.padding = padding;\n    }\n\n    this.hostElement.nativeElement.style.visibility = 'hidden';\n\n    setTimeout(() => {\n      this.initHostElementWidth = this.hostElement.nativeElement.offsetWidth;\n      this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + 'px';\n    });\n  }\n\n  update(): void {\n    this.setLeftPosition();\n    this.setTopPosition();\n    this.setWidth();\n\n    this.hostElement.nativeElement.style.visibility = 'visible';\n  }\n\n  private setTopPosition(): void {\n    const windowHeight = window.innerHeight;\n    const elementHeight = this.hostElement.nativeElement.getBoundingClientRect().height;\n    const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();\n\n    if (this.config.triggerDirective) {\n      const hostTopPosition =\n        this.config.type === 'context' ? this.config.bounds.top : triggerBounds.top + triggerBounds.height;\n      const isBelowWindowCenterHeight = elementHeight >= windowHeight - hostTopPosition - SPACE_FROM_BOTTOM;\n\n      if (isBelowWindowCenterHeight) {\n        if (this.config.type === 'context') {\n          this.setPositionStyle('top', +this.config.bounds.top - elementHeight + SPACE_FROM_TOP);\n        } else {\n          const newPos = triggerBounds.top - elementHeight - SPACE_FROM_TOP;\n          if (newPos > 0) {\n            this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);\n          } else {\n            this.hostElement.nativeElement.style.height =\n              windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;\n            this.hostElement.nativeElement.querySelector('.popover-content').style.height =\n              windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;\n          }\n        }\n      } else {\n        if (this.config.type === 'context') {\n          this.setPositionStyle('top', +this.config.bounds.top + SPACE_FROM_TOP);\n        } else {\n          this.setPositionStyle('top', triggerBounds.top + triggerBounds.height + SPACE_FROM_TOP);\n        }\n      }\n    }\n\n    if (!this.config.triggerDirective) {\n      const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();\n      const hostPosition = hostBounds.top;\n\n      if (elementHeight >= windowHeight - hostPosition - SPACE_FROM_BOTTOM) {\n        const diff = elementHeight - (windowHeight - hostPosition);\n        this.setPositionStyle('top', hostPosition - diff - SPACE_FROM_BOTTOM);\n      } else {\n        this.setPositionStyle('top', hostPosition);\n      }\n    }\n  }\n\n  private setLeftPosition(): void {\n    const windowWidth = window.innerWidth;\n    const elementWidth = this.hostElement.nativeElement.getBoundingClientRect().width;\n    const hostBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();\n\n    if (this.isContextType) {\n      if (+this.config.bounds.left >= windowWidth / 2) {\n        this.setPositionStyle('left', +this.config.bounds.left - elementWidth);\n      } else {\n        this.setPositionStyle('left', this.defaultLeftPosition);\n      }\n    } else if (this.config.triggerDirective) {\n      if (hostBounds.left >= windowWidth / 2) {\n        this.setPositionStyle('left', hostBounds.right - elementWidth);\n      } else {\n        this.setPositionStyle('left', hostBounds.left);\n      }\n    } else {\n      const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();\n\n      if (elementWidth > windowWidth - hostBounds.right) {\n        this.setPositionStyle('left', hostBounds.left - this.initHostElementWidth);\n      } else {\n        this.setPositionStyle('left', hostBounds.right);\n      }\n    }\n  }\n\n  private setWidth(): void {\n    const triggerBounds: ClientRect = this.config.triggerElement.nativeElement.getBoundingClientRect();\n\n    if (!this.isContextType && !this.isSubmenuType) {\n      const windowWidth = window.innerWidth;\n      const hostElBounds = this.hostElement.nativeElement.getBoundingClientRect();\n\n      this.hostElement.nativeElement.style.minWidth = triggerBounds.width + POSITION_MEASURE_UNIT;\n\n      if (!this.isMenuType) {\n        if (hostElBounds.left < 0 || hostElBounds.right > windowWidth) {\n          this.hostElement.nativeElement.style.width = windowWidth - 30 + POSITION_MEASURE_UNIT;\n          this.hostElement.nativeElement.querySelector('.popover-content').style.minWidth =\n            windowWidth - 30 + POSITION_MEASURE_UNIT;\n          this.setPositionStyle('left', 15);\n        }\n      }\n    }\n  }\n\n  private setPositionStyle(property: 'top' | 'left', value: number): void {\n    this.hostElement.nativeElement.style[property] = value + POSITION_MEASURE_UNIT;\n  }\n\n  private get defaultLeftPosition(): number {\n    return this.config.bounds.left;\n  }\n\n  private get canAssignPadding(): boolean {\n    return (\n      (!this.isContextType && !this.isMenuType && !this.isSubmenuType) ||\n      (this.isSubmenuType && !!this.config.content)\n    );\n  }\n\n  private get isContextType(): boolean {\n    return this.type === 'context';\n  }\n\n  private get isMenuType(): boolean {\n    return this.type === 'menu';\n  }\n\n  private get isSubmenuType(): boolean {\n    return this.type === 'submenu';\n  }\n\n  private get isTooltip(): boolean {\n    return this.type === 'tooltip';\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  AfterViewInit,\n  Output,\n  Input,\n  TemplateRef,\n  HostBinding,\n  OnInit,\n  OnChanges,\n} from '@angular/core';\nimport { fromEvent, Observable } from 'rxjs';\nimport { PopoverMenuComponent } from '../components/popover-menu/popover-menu.component';\nimport { tap } from 'rxjs/operators';\n\n@Directive({\n  selector: '[poppy-menu-item]',\n})\nexport class PopoverMenuItemDirective implements OnInit, AfterViewInit {\n  @Input() submenu: PopoverMenuComponent | TemplateRef<any>;\n  @Input() selected: boolean = false;\n  @Input() hidden: boolean = false;\n  @Output() clicked: EventEmitter<void> = new EventEmitter();\n\n  @HostBinding('class.popover-menu-item--selected')\n  get selectedClass(): boolean {\n    return this.selected;\n  }\n\n  @HostBinding('class.popover-menu-item--hidden')\n  get hiddenClass(): boolean {\n    return this.hidden;\n  }\n\n  clicked$: Observable<MouseEvent>;\n  hovered$: Observable<MouseEvent>;\n  global$: Observable<MouseEvent>;\n\n  constructor(public element: ElementRef) {}\n\n  ngOnInit(): void {\n    this.clicked$ = fromEvent<MouseEvent>(this.element.nativeElement, 'click').pipe(\n      tap(() => {\n        this.clicked.emit();\n      })\n    );\n    this.hovered$ = fromEvent(this.element.nativeElement, 'mousemove');\n    // this.global$ = fromEvent<MouseEvent>(document, 'click').pipe(tap(() => console.log('clicked window')));\n  }\n\n  ngAfterViewInit(): void {\n    this.element.nativeElement.classList.add('popover-menu-item');\n  }\n}\n","import { QueryList, ContentChildren, Component, TemplateRef, ViewChild, ChangeDetectionStrategy } from '@angular/core';\nimport { PopoverMenuItemDirective } from '../../directives/popover-menu-item.directive';\n\n@Component({\n  selector: 'poppy-menu',\n  exportAs: 'poppyMenu',\n  templateUrl: './popover-menu.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PopoverMenuComponent {\n  @ContentChildren(PopoverMenuItemDirective) menuItems: QueryList<PopoverMenuItemDirective>;\n  @ViewChild(TemplateRef) templateRef: TemplateRef<any>;\n\n  constructor() {}\n}\n","import {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  ComponentRef,\n  ElementRef,\n  Inject,\n  Injector,\n  NgZone,\n  OnDestroy,\n  ViewChild,\n  ViewRef,\n  ViewEncapsulation,\n  TemplateRef,\n} from '@angular/core';\nimport { AnimationEvent } from '@angular/animations';\nimport { fromEvent, Subject } from 'rxjs';\nimport { debounceTime, skipUntil, takeUntil } from 'rxjs/operators';\n\nimport { POPOVER_CONFIG, PopoverConfig } from '../../popover.token';\nimport { PopoverService } from '../../services/popover.service';\nimport { PopoverType } from '../../popover.interface';\nimport { PopoverAppendOptions } from '../../models/popover-append-options.model';\nimport { fadeInAnimation } from '../../popover.animations';\nimport { PopoverStyles } from '../../models/popover-styles.model';\nimport { PopoverEventsService } from '../../services/events.service';\nimport { PopoverMenuItemDirective } from '../../directives/popover-menu-item.directive';\nimport { PopoverMenuComponent } from '../popover-menu/popover-menu.component';\n\n@Component({\n  selector: 'poppy-content',\n  templateUrl: './popover-content.component.html',\n  styleUrls: ['./popover-content.component.scss'],\n  animations: [fadeInAnimation],\n  encapsulation: ViewEncapsulation.None,\n})\nexport class PopoverContentComponent implements OnDestroy, AfterViewInit {\n  @ViewChild('popoverWrapperEl') popoverWrapperEl: ElementRef;\n\n  componentRef: ComponentRef<PopoverContentComponent>;\n  parentPopoverRef: ComponentRef<PopoverContentComponent>;\n  animationState: 'open' | 'close' = 'close';\n  componentStyles: PopoverStyles;\n  private subMenuComponentRef: ComponentRef<PopoverContentComponent>;\n  private animationEnd$ = new Subject();\n  private menuItemsChanged = new Subject();\n  private destroy$ = new Subject();\n\n  constructor(\n    public readonly element: ElementRef,\n    private readonly ngZone: NgZone,\n    private readonly componentFactoryResolver: ComponentFactoryResolver,\n    private readonly popoverService: PopoverService,\n    private readonly popoverEventsService: PopoverEventsService,\n    private readonly cdr: ChangeDetectorRef,\n    @Inject(POPOVER_CONFIG) public readonly popoverConfig: PopoverConfig\n  ) {}\n\n  ngAfterViewInit(): void {\n    this.applyStyles();\n\n    if (this.popoverConfig.submenuTriggeredItem) {\n      this.popoverConfig.submenuTriggeredItem.element.nativeElement.classList.add(\n        'popover-menu-item--focused'\n      );\n    }\n\n    if (this.popoverConfig.innerClass) {\n      this.popoverWrapperEl.nativeElement.classList.add(this.popoverConfig.innerClass);\n    }\n\n    this.listenForMouseEventOnHost();\n\n    if (this.canListenForClickOutside()) {\n      this.ngZone.runOutsideAngular(() => {\n        setTimeout(() => {\n          this.listenForClickOutside();\n        });\n      });\n    }\n\n    if (this.popoverConfig.menuRef?.menuItems) {\n      this.listenForMenuItemTriggers();\n\n      // Subscribe to click outside event again, when menu items changed - it's workaround to refresh host element content;\n      this.popoverConfig.menuRef.menuItems.changes.pipe(takeUntil(this.destroy$)).subscribe(() => {\n        this.menuItemsChanged.next();\n\n        this.listenForMenuItemTriggers();\n        this.popoverEventsService.unregister(\n          'click-outside',\n          this.popoverService.getActive(this.componentRef)\n        );\n        setTimeout(() => {\n          this.listenForClickOutside();\n          this.componentStyles.update();\n        }, 0);\n      });\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.popoverConfig.submenuTriggeredItem) {\n      this.popoverConfig.submenuTriggeredItem.element.nativeElement.classList.remove(\n        'popover-menu-item--focused'\n      );\n    }\n\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  get template(): TemplateRef<any> {\n    return (\n      (this.popoverConfig.content instanceof TemplateRef &&\n        (this.popoverConfig.content as TemplateRef<any>)) ||\n      this.popoverConfig.menuRef?.templateRef\n    );\n  }\n\n  animationEnd(event: AnimationEvent): void {\n    if (event.toState === 'open') {\n      this.animationEnd$.next();\n    }\n  }\n\n  private applyStyles(): void {\n    this.componentStyles = new PopoverStyles(this);\n    this.componentStyles.init();\n\n    setTimeout(() => {\n      this.componentStyles.update();\n      this.animationState = 'open';\n      this.detectChanges();\n    });\n  }\n\n  private onClickMenuItem(item: PopoverMenuItemDirective): void {\n    const hasItemNestedSubpopovers = !!item.submenu;\n\n    if (!hasItemNestedSubpopovers) {\n      if (this.popoverConfig.closeOnClickItem) {\n        this.close();\n      }\n    }\n  }\n\n  private onHoverMenuItem(item: PopoverMenuItemDirective): void {\n    const canRemoveNestedSubmenus = !this.popoverService.activePopovers.find(\n      (popover) => popover.popoverRef.instance.popoverConfig.submenuTriggeredItem === item\n    );\n    const hasItemNestedSubpopovers = !!item.submenu;\n\n    if (canRemoveNestedSubmenus) {\n      this.popoverService.removeAllNestedPopovers(this.componentRef);\n      this.detectChanges();\n    }\n\n    const isSubmenuExists = this.popoverService.isPopoverSubmenuExits(\n      this.componentRef,\n      this.parentPopoverRef\n    );\n\n    if (!isSubmenuExists && hasItemNestedSubpopovers && canRemoveNestedSubmenus) {\n      this.createSubpopover(item);\n    }\n  }\n\n  private listenForClickOutside(): void {\n    const activePopover = this.popoverService.getActive(this.componentRef);\n\n    this.popoverEventsService.register('click-outside', activePopover, (event) => {\n      const clickedElement = event.target;\n      let clickedOutside =\n        clickedElement !== this.element.nativeElement &&\n        !this.element.nativeElement.contains(clickedElement) &&\n        clickedElement !== this.popoverConfig.triggerElement.nativeElement &&\n        !this.popoverConfig.triggerElement.nativeElement.contains(clickedElement);\n\n      if (\n        this.popoverConfig.type === 'context' &&\n        (clickedElement === this.popoverConfig.triggerElement.nativeElement ||\n          this.popoverConfig.triggerElement.nativeElement.contains(clickedElement))\n      ) {\n        clickedOutside = true;\n      }\n      if (clickedOutside) {\n        this.close();\n      }\n    });\n  }\n\n  private listenForMouseEventOnHost(): void {\n    fromEvent(this.element.nativeElement, 'mouseenter')\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        const enteredPopover = this.popoverService.getActive(this.componentRef);\n\n        if (enteredPopover?.deepLevel) {\n          this.popoverService.activePopovers.forEach((popover, index) => {\n            if (index <= enteredPopover.deepLevel) {\n              this.popoverEventsService.unsubscribe('click-outside', popover);\n            } else {\n              this.popoverEventsService.subscribe('click-outside', popover);\n            }\n          });\n        }\n      });\n    fromEvent(this.element.nativeElement, 'mouseleave')\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        this.popoverService.activePopovers.forEach((popover) => {\n          this.popoverEventsService.subscribe('click-outside', popover);\n        });\n      });\n  }\n\n  private listenForMenuItemTriggers(): void {\n    this.popoverConfig.menuRef.menuItems.forEach((item) => {\n      item.clicked$.pipe(takeUntil(this.destroy$), takeUntil(this.menuItemsChanged)).subscribe(() => {\n        this.onClickMenuItem(item);\n      });\n      item.hovered$\n        .pipe(\n          takeUntil(this.destroy$),\n          takeUntil(this.menuItemsChanged),\n          debounceTime(0),\n          skipUntil(this.animationEnd$)\n        )\n        .subscribe(() => {\n          this.onHoverMenuItem(item);\n        });\n    });\n  }\n\n  private close(): void {\n    if (this.isMenu()) {\n      this.popoverService.subscribeToClickOutsideEventForParentPopover(this.componentRef);\n      this.popoverService.removeMenu(this.parentPopoverRef);\n    } else {\n      this.popoverService.remove(this.componentRef);\n    }\n  }\n\n  private createSubpopover(item: PopoverMenuItemDirective): void {\n    const factory = this.componentFactoryResolver.resolveComponentFactory(PopoverContentComponent);\n    const bounds = item.element.nativeElement.getBoundingClientRect();\n    const type: PopoverType = 'submenu';\n    const options = new PopoverAppendOptions({ type });\n\n    const providedValues: PopoverConfig = {\n      bounds,\n      type,\n      submenuTriggeredItem: item,\n      triggerElement: this.popoverConfig.triggerElement,\n      closeOnClickItem: this.popoverConfig.closeOnClickItem,\n    };\n\n    if (item?.submenu instanceof PopoverMenuComponent) {\n      providedValues.menuRef = item.submenu;\n    }\n    if (item?.submenu instanceof TemplateRef) {\n      providedValues.content = item.submenu;\n    }\n\n    const injector = Injector.create([\n      {\n        provide: POPOVER_CONFIG,\n        useValue: providedValues,\n      },\n    ]);\n\n    this.subMenuComponentRef = this.popoverService.append(injector, null, options, this.parentPopoverRef);\n    this.subMenuComponentRef.instance.componentRef = this.subMenuComponentRef;\n    this.subMenuComponentRef.instance.parentPopoverRef = this.parentPopoverRef;\n    this.subMenuComponentRef.hostView.detectChanges();\n  }\n\n  private isMenu(): boolean {\n    return (\n      this.popoverConfig.type === 'menu' ||\n      this.popoverConfig.type === 'context' ||\n      this.popoverConfig.type === 'submenu'\n    );\n  }\n\n  private canListenForClickOutside(): boolean {\n    return (\n      this.popoverConfig.closeOnClickOutside && (this.popoverConfig.trigger !== 'hover' || this.isMenu())\n    );\n  }\n\n  private detectChanges(): void {\n    if (this.cdr && !(this.cdr as ViewRef).destroyed) {\n      this.cdr.detectChanges();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { LayerComponent } from './layer.component';\n\n@NgModule({\n  declarations: [LayerComponent],\n  imports: [CommonModule],\n})\nexport class LayerModule {}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import {\n  ComponentFactoryResolver,\n  ComponentRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnDestroy,\n  Output,\n  ElementRef,\n  NgZone,\n  Directive,\n  OnInit,\n} from '@angular/core';\nimport { PopoverContentComponent } from '../components/popover-content/popover-content.component';\nimport { Subject } from 'rxjs';\n\nimport { PopoverService } from '../services/popover.service';\nimport { PopoverAppendOptions } from '../models/popover-append-options.model';\nimport { PopoverTrigger, PopoverType } from '../popover.interface';\n\n@Directive()\nexport abstract class BasePopoverDirective implements OnDestroy, OnInit {\n  @Input() trigger: PopoverTrigger = 'click';\n  // Options\n  @Input() delayClose: number = null;\n  @Input() closeOnTriggerAgain = undefined;\n  @Input() closeOnClickOutside = true;\n  @Input() hideOnScroll: boolean = false;\n  @Input() innerClass: string;\n  // Emitters\n  @Output() afterClose = new EventEmitter();\n  @Output() afterShow = new EventEmitter();\n\n  popoverComponentRef: ComponentRef<PopoverContentComponent>;\n  protected type: PopoverType = 'popover';\n  protected destroy$ = new Subject();\n\n  protected constructor(\n    protected readonly componentFactoryResolver: ComponentFactoryResolver,\n    protected readonly popoverService: PopoverService,\n    public readonly hostElement: ElementRef,\n    protected readonly ngZone: NgZone\n  ) {}\n\n  ngOnInit(): void {\n    this.setOptions();\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.unsubscribe();\n  }\n\n  public abstract open(): void;\n\n  protected abstract getPopoverComponentInjector(): Injector;\n\n  protected abstract canAppend(): boolean;\n\n  public close(): void {\n    if (this.popoverComponentRef) {\n      this.remove(this.popoverComponentRef);\n    }\n  }\n\n  protected appendToLayer(options: PopoverAppendOptions): void {\n    const injector = this.getPopoverComponentInjector();\n    const opts: PopoverAppendOptions = {\n      ...options,\n      delayClose: this.delayClose,\n      closeOnTriggerAgain: this.closeOnTriggerAgain,\n      hideOnScroll: this.hideOnScroll,\n    };\n\n    this.popoverComponentRef = this.popoverService.append(injector, this, opts);\n  }\n\n  protected remove(popoverRef: ComponentRef<PopoverContentComponent>): void {\n    this.ngZone.run(() => {\n      this.popoverService.remove(popoverRef);\n    });\n  }\n\n  private setOptions(): void {\n    if (this.closeOnTriggerAgain === undefined) {\n      this.closeOnTriggerAgain = !(this.type === 'tooltip' || this.trigger === 'hover');\n    }\n  }\n}\n","import {\n  AfterViewInit,\n  ComponentFactoryResolver,\n  Directive,\n  ElementRef,\n  Injector,\n  Input,\n  NgZone,\n  TemplateRef,\n} from '@angular/core';\nimport { fromEvent, merge, timer } from 'rxjs';\nimport { takeUntil, debounceTime, tap, switchMap, take } from 'rxjs/operators';\nimport { POPOVER_CONFIG, PopoverConfig } from '../popover.token';\nimport { PopoverService } from '../services/popover.service';\nimport { PopoverAppendOptions } from '../models/popover-append-options.model';\nimport { BasePopoverDirective } from './base-popover';\nimport { PopoverType } from '../popover.interface';\n\n@Directive({\n  selector: '[poppyPopover]',\n  exportAs: 'poppyPopover',\n})\nexport class PopoverDirective extends BasePopoverDirective implements AfterViewInit {\n  @Input() poppyPopover: TemplateRef<HTMLElement> | string;\n\n  constructor(\n    protected readonly componentFactoryResolver: ComponentFactoryResolver,\n    protected readonly popoverService: PopoverService,\n    public readonly hostElement: ElementRef,\n    protected readonly ngZone: NgZone\n  ) {\n    super(componentFactoryResolver, popoverService, hostElement, ngZone);\n  }\n\n  ngAfterViewInit(): void {\n    if (this.poppyPopover) {\n      this.ngZone.runOutsideAngular(() => {\n        if (this.trigger === 'click') {\n          this.listenEventsForClickTrigger();\n        }\n\n        if (this.trigger === 'hover') {\n          this.listenEventsForHoverTrigger();\n        }\n      });\n    }\n  }\n\n  open(): void {\n    if (this.canAppend()) {\n      this.ngZone.run(() => {\n        this.append();\n      });\n    }\n  }\n\n  protected getPopoverComponentInjector(): Injector {\n    const providerValues: PopoverConfig = {\n      bounds: this.hostElement.nativeElement.getBoundingClientRect(),\n      type: this.type,\n      trigger: this.trigger,\n      triggerElement: this.hostElement,\n      triggerDirective: this,\n      content: this.poppyPopover,\n      closeOnClickOutside: this.closeOnClickOutside,\n      innerClass: this.innerClass,\n    };\n\n    return Injector.create([\n      {\n        provide: POPOVER_CONFIG,\n        useValue: providerValues,\n      },\n    ]);\n  }\n\n  protected canAppend(): boolean {\n    return !this.popoverComponentRef || (this.popoverComponentRef && this.closeOnTriggerAgain);\n  }\n\n  private listenEventsForClickTrigger(): void {\n    fromEvent(this.hostElement.nativeElement, 'click')\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        this.open();\n      });\n  }\n\n  private listenEventsForHoverTrigger(): void {\n    let popoverHovered = false;\n    let hostHovered = false;\n    let isMouseLeftBeforeDelayTimePast = false;\n\n    merge(\n      fromEvent(this.hostElement.nativeElement, 'mouseenter'),\n      fromEvent(this.hostElement.nativeElement, 'click')\n    )\n      .pipe(\n        takeUntil(this.destroy$),\n        tap(() => {\n          fromEvent(this.hostElement.nativeElement, 'mouseleave')\n            .pipe(takeUntil(this.destroy$), takeUntil(this.afterClose), debounceTime(200))\n            .subscribe(() => {\n              hostHovered = false;\n              isMouseLeftBeforeDelayTimePast = true;\n              setTimeout(() => {\n                isMouseLeftBeforeDelayTimePast = false;\n              }, 200);\n              if (!popoverHovered) {\n                this.remove(this.popoverComponentRef);\n              }\n            });\n        }),\n        switchMap(() => timer(300))\n      )\n      .subscribe(() => {\n        const isHostElementStillInDOM = document.body.contains(this.hostElement.nativeElement);\n        popoverHovered = false;\n        hostHovered = true;\n\n        if (isHostElementStillInDOM && !isMouseLeftBeforeDelayTimePast) {\n          this.open();\n        }\n\n        setTimeout(() => {\n          if (this.popoverComponentRef) {\n            fromEvent(this.popoverComponentRef.instance.element.nativeElement, 'mouseenter')\n              .pipe(takeUntil(this.afterClose))\n              .subscribe(() => {\n                popoverHovered = true;\n              });\n\n            fromEvent(this.popoverComponentRef.instance.element.nativeElement, 'mouseleave')\n              .pipe(takeUntil(this.afterClose))\n              .subscribe(() => {\n                popoverHovered = false;\n                if (!hostHovered) {\n                  this.remove(this.popoverComponentRef);\n                }\n              });\n          }\n        }, 0);\n      });\n\n    this.destroy$.pipe(take(1)).subscribe(() => {\n      if (this.popoverComponentRef) {\n        this.remove(this.popoverComponentRef);\n      }\n    });\n  }\n\n  private append(): void {\n    const options = new PopoverAppendOptions({\n      type: 'popover',\n      triggeredBy: this.trigger,\n    });\n\n    this.appendToLayer(options);\n  }\n}\n","import { Directive, TemplateRef } from '@angular/core';\n\n@Directive({\n  selector: '[poppy-chip]',\n  exportAs: 'poppyChip'\n})\nexport class PopoverChipDirective {\n  constructor(public template: TemplateRef<any>) {}\n}\n","import { Directive, Input, HostListener } from '@angular/core';\nimport { PopoverSelectComponent } from '../components/popover-select/popover-select.component';\n\n@Directive({\n  selector: '[poppyChipRemove]'\n})\nexport class PopoverChipRemoveDirective {\n  @Input() poppyChipRemove: any;\n\n  @HostListener('click', ['$event'])\n  onClick(event: Event) {\n    this.remove(event);\n  }\n\n  constructor(private selectComponentRef: PopoverSelectComponent) {}\n\n  remove(event: Event): void {\n    if (this.selectComponentRef) {\n      this.selectComponentRef.closeChip(this.poppyChipRemove, event);\n    }\n  }\n}\n","import {\n  AfterViewInit,\n  ComponentFactoryResolver,\n  Directive,\n  ElementRef,\n  Injector,\n  Input,\n  NgZone,\n} from '@angular/core';\nimport { fromEvent } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { POPOVER_CONFIG, PopoverConfig } from '../popover.token';\nimport { PopoverBounds, PopoverContextMenuPosition, PopoverMenuType } from '../popover.interface';\nimport { PopoverService } from '../services/popover.service';\nimport { PopoverAppendOptions } from '../models/popover-append-options.model';\nimport { BasePopoverDirective } from './base-popover';\nimport { PopoverMenuComponent } from '../components/popover-menu/popover-menu.component';\n\n@Directive({\n  selector: '[poppyMenu]',\n  exportAs: 'poppyMenu',\n})\nexport class PopoverMenuDirective extends BasePopoverDirective implements AfterViewInit {\n  @Input() poppyMenu: PopoverMenuComponent;\n  @Input() type: PopoverMenuType = 'menu';\n  @Input() closeOnClickItem: boolean = true;\n\n  private contextMenuPosition: PopoverContextMenuPosition;\n\n  constructor(\n    protected readonly componentFactoryResolver: ComponentFactoryResolver,\n    protected readonly popoverService: PopoverService,\n    public readonly hostElement: ElementRef,\n    protected readonly ngZone: NgZone\n  ) {\n    super(componentFactoryResolver, popoverService, hostElement, ngZone);\n  }\n\n  ngAfterViewInit(): void {\n    if (this.poppyMenu) {\n      this.ngZone.runOutsideAngular(() => {\n        if (this.trigger !== 'manual' && this.type === 'menu') {\n          this.listenEventsForClickTrigger();\n        }\n\n        if (this.type === 'context') {\n          this.listenEventsForContextTrigger();\n        }\n      });\n    }\n  }\n\n  open(): void {\n    if (this.canAppend()) {\n      this.ngZone.run(() => {\n        this.append();\n      });\n    }\n  }\n\n  // NOTE: It should be removed after upgrade to ng 9, because QueryList should emit changes\n  // when elements is removed\n  updateContentPosition(): void {\n    if (this.popoverComponentRef) {\n      this.popoverComponentRef.instance.componentStyles.update();\n    }\n  }\n\n  protected getPopoverComponentInjector(): Injector {\n    const providerValues: PopoverConfig = {\n      bounds: this.getBounds(),\n      type: this.type,\n      triggerElement: this.hostElement,\n      triggerDirective: this,\n      closeOnClickOutside: this.closeOnClickOutside,\n      closeOnClickItem: this.closeOnClickItem,\n      menuRef: this.poppyMenu,\n      innerClass: this.innerClass,\n    };\n\n    return Injector.create([\n      {\n        provide: POPOVER_CONFIG,\n        useValue: providerValues,\n      },\n    ]);\n  }\n\n  protected canAppend(): boolean {\n    return (\n      !this.popoverComponentRef ||\n      (this.popoverComponentRef && this.type === 'context') ||\n      (this.popoverComponentRef && this.closeOnTriggerAgain)\n    );\n  }\n\n  private listenEventsForClickTrigger(): void {\n    fromEvent(this.hostElement.nativeElement, 'click')\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        this.open();\n      });\n  }\n\n  private listenEventsForContextTrigger(): void {\n    fromEvent(this.hostElement.nativeElement, 'contextmenu')\n      .pipe(takeUntil(this.destroy$))\n      .subscribe((event: MouseEvent) => {\n        event.preventDefault();\n        this.contextMenuPosition = {\n          top: event.clientY,\n          left: event.clientX,\n        };\n        this.open();\n      });\n  }\n\n  private append(): void {\n    const options = new PopoverAppendOptions({\n      type: this.type,\n    });\n\n    this.appendToLayer(options);\n  }\n\n  private getBounds(): PopoverBounds {\n    if (this.type === 'context') {\n      return { top: this.contextMenuPosition.top, left: this.contextMenuPosition.left };\n    } else {\n      return this.hostElement.nativeElement.getBoundingClientRect();\n    }\n  }\n}\n","import { Directive, TemplateRef } from '@angular/core';\n\n@Directive({\n  selector: '[poppy-option]',\n  exportAs: 'poppyOption',\n})\nexport class PopoverOptionDirective {\n  constructor(public template: TemplateRef<any>) {}\n}\n","import { Directive, ElementRef, HostListener } from '@angular/core';\nimport { PopoverService } from '../services/popover.service';\n@Directive({\n  selector: '[poppyRemoveOnClick]',\n})\nexport class PopoverRemoveOnClickDirective {\n  @HostListener('click', ['$event'])\n  onClick(): void {\n    this.remove();\n  }\n\n  constructor(private host: ElementRef, private popoverService: PopoverService) {}\n\n  remove(): void {\n    setTimeout(() => {\n      const parentElement = this.host.nativeElement.closest('poppy-content');\n      this.popoverService.removeByNativeElementRef(parentElement);\n    });\n  }\n}\n","import {\n  ComponentFactoryResolver,\n  Directive,\n  ElementRef,\n  Input,\n  NgZone,\n  OnInit,\n  TemplateRef,\n} from '@angular/core';\n\nimport { PopoverDirective } from './popover.directive';\nimport { PopoverService } from '../services/popover.service';\nimport { PopoverTrigger, PopoverType } from '../popover.interface';\n\n@Directive({\n  selector: '[poppyTooltip]',\n})\nexport class TooltipDirective extends PopoverDirective implements OnInit {\n  @Input() poppyTooltip: string | TemplateRef<any>;\n\n  trigger: PopoverTrigger = 'hover';\n  type: PopoverType = 'tooltip';\n\n  constructor(\n    protected readonly componentFactoryResolver: ComponentFactoryResolver,\n    protected readonly popoverService: PopoverService,\n    public readonly hostElement: ElementRef,\n    protected readonly ngZone: NgZone\n  ) {\n    super(componentFactoryResolver, popoverService, hostElement, ngZone);\n  }\n\n  ngOnInit(): void {\n    this.poppyPopover = this.poppyTooltip;\n  }\n}\n","import {\n  Component,\n  OnInit,\n  ViewEncapsulation,\n  forwardRef,\n  Input,\n  ViewChild,\n  ElementRef,\n  ChangeDetectorRef,\n  ContentChild,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  AfterViewInit,\n  Optional,\n  Host,\n  SkipSelf,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor, ControlContainer, NG_VALIDATORS } from '@angular/forms';\nimport { debounceTime, map, take, takeUntil, tap } from 'rxjs/operators';\nimport { fromEvent, Observable, Subject } from 'rxjs';\n\nimport { SelectOption, DisplayedSelectOption } from './popover-select.interface';\nimport { PopoverChipDirective, PopoverMenuDirective, PopoverOptionDirective } from '../../directives';\n\n@Component({\n  // tslint:disable-next-line:component-selector\n  selector: 'poppy-select',\n  templateUrl: './popover-select.component.html',\n  styleUrls: ['./popover-select.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => PopoverSelectComponent),\n      multi: true,\n    },\n    {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => PopoverSelectComponent),\n      multi: true,\n    },\n  ],\n})\nexport class PopoverSelectComponent implements OnInit, OnChanges, OnDestroy, AfterViewInit, ControlValueAccessor {\n  @Input() options: SelectOption[] = [];\n  @Input() async: (searchPhrase?: string) => Observable<any>;\n  @Input() value: any;\n  @Input() bindLabel: string = 'label';\n  @Input() bindValue: string;\n  @Input() multiselect: boolean = false;\n  @Input() clearable: boolean = true;\n  @Input() searchable: boolean = true;\n  @Input() placeholder: string = 'Wybierz..';\n  @Input() notFoundText: string = 'Nie znaleziono wyników';\n\n  @Output() changed: EventEmitter<any> = new EventEmitter<any>();\n\n  @ViewChild('input') inputEl: ElementRef;\n  @ViewChild(PopoverMenuDirective) menuRef: PopoverMenuDirective;\n  @ContentChild(PopoverChipDirective) chipTemplate: PopoverChipDirective;\n  @ContentChild(PopoverOptionDirective) optionTemplate: PopoverOptionDirective;\n\n  selectedOptions: SelectOption[] = [];\n  displayedOptions: DisplayedSelectOption[] = [];\n  displayedChips: SelectOption[] = [];\n  asyncLoading: boolean = false;\n  isMenuOpen: boolean = false;\n  private destroy$ = new Subject();\n\n  constructor(\n    private cdr: ChangeDetectorRef,\n    @Optional()\n    @Host()\n    @SkipSelf()\n    private controlContainer: ControlContainer\n  ) {}\n\n  ngOnInit(): void {}\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes.options && changes.options.previousValue !== changes.options.currentValue) {\n      this.onOptionsChange();\n    }\n\n    if (changes.value && changes.value.previousValue !== changes.value.currentValue) {\n      this.writeValue(this.value);\n    }\n  }\n\n  ngAfterViewInit(): void {\n    this.menuRef.afterClose.pipe(takeUntil(this.destroy$)).subscribe(() => {\n      this.isMenuOpen = false;\n      if (!this.multiselect) {\n        this.onCloseMenu();\n      }\n      this.cdr.detectChanges();\n    });\n\n    this.menuRef.afterShow.pipe(takeUntil(this.destroy$)).subscribe(() => {\n      this.isMenuOpen = true;\n      this.cdr.detectChanges();\n    });\n\n    this.menuRef.afterClose.pipe(take(1)).subscribe(() => {\n      // TODO: mark as touched..\n      // if (this.control) {\n      //   this.control.markAsTouched();\n      //   this.control.updateValueAndValidity();\n      // }\n    });\n\n    if (this.async) {\n      this.loadAsyncOptions(null, { firstLoad: true });\n    }\n\n    if (this.searchable) {\n      this.onInputKeyUp();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  get noItemsFound(): boolean {\n    return !this.displayedOptions.length || !!this.displayedOptions.every((opt) => opt.hidden);\n  }\n\n  writeValue(value: any): void {\n    if (value !== undefined) {\n      if (this.multiselect) {\n        this.updateSelectedItemsForMultiSelection(value);\n      } else {\n        this.updateSelectedItemsForSingleSelection(value);\n      }\n    } else {\n      this.reset();\n    }\n\n    setTimeout(() => {\n      this.cdr.detectChanges();\n    });\n  }\n\n  registerOnChange(fn: any): void {\n    this.propagateChange = fn;\n  }\n\n  registerOnTouched(): void {}\n\n  setDisabledState(isDisabled: boolean): void {}\n\n  propagateChange = (value) => {};\n\n  getDisplayLabel(option: SelectOption): string {\n    return this.bindLabel ? option[this.bindLabel] : '';\n  }\n\n  onClickItem(clickedOption: SelectOption): void {\n    this.selectedOptions = [];\n    this.displayedOptions.forEach((option, index) => {\n      if (this.matchByValueOrReference(option, clickedOption)) {\n        this.displayedOptions[index].selected = this.multiselect ? !option.selected : true;\n        this.displayedOptions[index].hidden = this.multiselect ? !option.hidden : false;\n      } else {\n        if (!this.multiselect) {\n          this.displayedOptions[index].selected = false;\n        }\n      }\n      if (this.displayedOptions[index].selected) {\n        this.selectedOptions.push(this.options[index]);\n      }\n    });\n\n    if (this.multiselect) {\n      this.updateDisplayedChips();\n    }\n\n    if (!this.multiselect) {\n      this.inputEl.nativeElement.value = this.bindLabel ? this.selectedOptions[0][this.bindLabel] : '';\n    }\n\n    this.emitChange();\n    this.cdr.detectChanges();\n  }\n\n  onChangeInput(target: EventTarget): void {\n    const value = (target as HTMLInputElement).value;\n\n    if (this.bindLabel) {\n      if (this.async) {\n        this.loadAsyncOptions(value);\n      } else {\n        this.displayedOptions.forEach((option, index) => {\n          this.displayedOptions[index].hidden = !option[this.bindLabel].includes(value);\n        });\n        this.cdr.detectChanges();\n      }\n    }\n  }\n\n  clear(event: Event): void {\n    event.stopPropagation();\n    this.reset();\n    this.emitChange();\n  }\n\n  getDisplayValue(): string {\n    if (!!this.selectedOptions.length) {\n      if (this.multiselect) {\n        return '';\n      }\n      if (typeof this.selectedOptions[0] === 'object' && this.bindLabel) {\n        return this.selectedOptions[0][this.bindLabel];\n      }\n      return '';\n    }\n    return '';\n  }\n\n  closeChip(chip: SelectOption, event: Event): void {\n    this.selectedOptions = [];\n    this.displayedOptions.forEach((option, index) => {\n      if (this.matchByValueOrReference(option, chip)) {\n        this.displayedOptions[index].selected = false;\n        this.displayedOptions[index].hidden = false;\n      }\n      if (this.displayedOptions[index].selected) {\n        this.selectedOptions.push(this.options[index]);\n      }\n    });\n\n    this.updateDisplayedChips();\n    this.emitChange();\n\n    if (event) {\n      event.stopPropagation();\n    }\n\n    this.cdr.detectChanges();\n  }\n\n  private onOptionsChange(): void {\n    this.displayedOptions = [...this.options].map((option) => ({\n      ...option,\n      selected: false,\n      hidden: false,\n    }));\n  }\n\n  private onInputKeyUp(): void {\n    fromEvent(this.inputEl.nativeElement, 'keyup')\n      .pipe(\n        tap(() => {\n          if (this.async) {\n            this.asyncLoading = true;\n          }\n        }),\n        debounceTime(!!this.async ? 500 : 0),\n        map((event: Event) => event.target),\n        takeUntil(this.destroy$)\n      )\n      .subscribe((target) => {\n        this.onChangeInput(target);\n      });\n  }\n\n  private reset(): void {\n    this.displayedOptions.forEach((option, index) => {\n      this.displayedOptions[index].hidden = false;\n      this.displayedOptions[index].selected = false;\n    });\n    this.selectedOptions = [];\n    if (this.multiselect) {\n      this.displayedChips = [];\n    }\n  }\n\n  private emitChange(): void {\n    const value = this.getPropagateValue();\n    this.propagateChange(value);\n    this.changed.emit(value);\n  }\n\n  private getPropagateValue(): any | any[] {\n    if (!this.selectedOptions.length) {\n      return this.multiselect ? [] : null;\n    }\n    if (this.multiselect) {\n      return this.bindValue\n        ? this.selectedOptions.map((option) => option[this.bindValue])\n        : this.selectedOptions;\n    }\n    return this.bindValue ? this.selectedOptions[0][this.bindValue] : this.selectedOptions[0];\n  }\n\n  private onCloseMenu(): void {\n    this.inputEl.nativeElement.value = !!this.selectedOptions.length\n      ? this.selectedOptions[0][this.bindLabel]\n      : null;\n    this.displayedOptions.forEach((option, index) => {\n      this.displayedOptions[index].hidden = false;\n    });\n  }\n\n  private loadAsyncOptions(searchPhrase?: string, options: { firstLoad?: boolean } = {}): void {\n    this.asyncLoading = !options.firstLoad;\n    this.async(searchPhrase).subscribe((results) => {\n      this.options = results;\n      this.onOptionsChange();\n      this.asyncLoading = false;\n      this.cdr.detectChanges();\n    });\n  }\n\n  private updateSelectedItemsForMultiSelection(value: SelectOption[]): void {\n    if (!Array.isArray(value)) {\n      if (value !== null) {\n        throw Error('Initial value for multiselect must be an array!');\n      } else {\n        value = [];\n      }\n    }\n\n    this.selectedOptions = [];\n    this.displayedChips = [];\n    this.options.forEach((option, index) => {\n      const matchOption = !!value.find((v) => this.matchByValueOrReference(option, v));\n\n      if (matchOption) {\n        this.selectedOptions.push(option);\n        this.displayedOptions[index].selected = true;\n        this.displayedOptions[index].hidden = true;\n      } else {\n        this.displayedOptions[index].selected = false;\n        this.displayedOptions[index].hidden = false;\n      }\n    });\n\n    this.updateDisplayedChips();\n  }\n\n  private updateSelectedItemsForSingleSelection(value: any): void {\n    this.options.forEach((option, index) => {\n      if (this.matchByValueOrReference(option, value)) {\n        this.selectedOptions = [option];\n        this.displayedOptions[index].selected = true;\n      } else {\n        this.displayedOptions[index].selected = false;\n      }\n    });\n\n    if (!value) {\n      this.selectedOptions = [];\n    }\n  }\n\n  private updateDisplayedChips(): void {\n    this.displayedOptions\n      .filter((option) => option.selected)\n      .forEach((option) => {\n        const chipIndex = this.displayedChips.findIndex((chip) => this.matchByValueOrReference(chip, option));\n        if (chipIndex === -1) {\n          this.displayedChips.push(option);\n        }\n      });\n    this.displayedChips.forEach((chip, index) => {\n      const option = this.displayedOptions\n        .filter((opt) => opt.selected)\n        .find((opt) => this.matchByValueOrReference(chip, opt));\n      if (!option) {\n        this.displayedChips.splice(index, 1);\n      }\n    });\n\n    if (this.menuRef) {\n      setTimeout(() => {\n        this.menuRef.updateContentPosition();\n      });\n    }\n  }\n\n  private matchByValueOrReference(item: SelectOption, comparedTo: SelectOption): boolean {\n    if (this.bindValue) {\n      if (comparedTo && comparedTo[this.bindValue] !== undefined) {\n        // tslint:disable-next-line:triple-equals\n        return item[this.bindValue] == comparedTo[this.bindValue];\n      }\n      // tslint:disable-next-line:triple-equals\n      return item[this.bindValue] == comparedTo;\n    }\n\n    return item === comparedTo;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PopoverContentComponent } from './components/popover-content/popover-content.component';\nimport { LayerModule } from '../layer/layer.module';\nimport { PopoverMenuComponent } from './components/popover-menu/popover-menu.component';\nimport { PopoverSelectComponent } from './components/popover-select/popover-select.component';\nimport {\n  TooltipDirective,\n  PopoverDirective,\n  PopoverChipDirective,\n  PopoverChipRemoveDirective,\n  PopoverMenuDirective,\n  PopoverMenuItemDirective,\n  PopoverOptionDirective,\n  PopoverRemoveOnClickDirective,\n} from './directives';\nimport {BrowserAnimationsModule} from '@angular/platform-browser/animations';\n\n@NgModule({\n  declarations: [\n    PopoverDirective,\n    PopoverMenuDirective,\n    PopoverContentComponent,\n    PopoverMenuItemDirective,\n    PopoverMenuComponent,\n    PopoverSelectComponent,\n    PopoverChipDirective,\n    PopoverChipRemoveDirective,\n    PopoverRemoveOnClickDirective,\n    PopoverOptionDirective,\n    TooltipDirective,\n  ],\n  imports: [CommonModule, BrowserAnimationsModule, LayerModule],\n  exports: [\n    PopoverDirective,\n    PopoverMenuDirective,\n    PopoverMenuItemDirective,\n    PopoverMenuComponent,\n    PopoverSelectComponent,\n    PopoverChipDirective,\n    PopoverChipRemoveDirective,\n    PopoverRemoveOnClickDirective,\n    PopoverOptionDirective,\n    TooltipDirective,\n  ],\n})\nexport class PopoverModule {}\n"]}
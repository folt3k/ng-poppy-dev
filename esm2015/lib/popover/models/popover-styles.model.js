const SPACE_FROM_BOTTOM = 20;
const SPACE_FROM_TOP = 10;
const POSITION_MEASURE_UNIT = 'px';
export class PopoverStyles {
    constructor(popover) {
        this.initHostElementWidth = 0;
        this.popover = popover;
        this.hostElement = popover.element;
        this.config = popover.popoverConfig;
        this.type = this.config.type;
    }
    init() {
        const hostBounds = this.config.bounds;
        this.hostElement.nativeElement.style.zIndex = 10000;
        this.setPositionStyle('left', 0);
        this.setPositionStyle('top', +hostBounds.top + hostBounds.height + SPACE_FROM_TOP);
        if (!this.isContextType && !this.isSubmenuType) {
            this.hostElement.nativeElement.style.minWidth = hostBounds.width + 'px';
        }
        if (this.isContextType) {
            this.setPositionStyle('top', +hostBounds.top);
            this.hostElement.nativeElement.style.minWidth = 0;
        }
        if (this.isSubmenuType) {
            const triggerItem = this.config.submenuTriggeredItem.element.nativeElement;
            const triggerBounds = triggerItem.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = 0;
            this.setPositionStyle('top', triggerBounds.top);
        }
        if (this.canAssignPadding) {
            const padding = this.isTooltip ? '8px 12px' : '15px 25px';
            this.popover.popoverWrapperEl.nativeElement.style.padding = padding;
        }
        this.hostElement.nativeElement.style.visibility = 'hidden';
        setTimeout(() => {
            this.initHostElementWidth = this.hostElement.nativeElement.offsetWidth;
            this.hostElement.nativeElement.style.minWidth = this.initHostElementWidth + 'px';
        });
    }
    update() {
        this.setLeftPosition();
        this.setTopPosition();
        this.setWidth();
        this.hostElement.nativeElement.style.visibility = 'visible';
    }
    setTopPosition() {
        const windowHeight = window.innerHeight;
        const elementHeight = this.hostElement.nativeElement.getBoundingClientRect().height;
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.config.triggerDirective) {
            const hostTopPosition = this.config.type === 'context' ? this.config.bounds.top : triggerBounds.top + triggerBounds.height;
            const isBelowWindowCenterHeight = elementHeight >= windowHeight - hostTopPosition - SPACE_FROM_BOTTOM;
            if (isBelowWindowCenterHeight) {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top - elementHeight + SPACE_FROM_TOP);
                }
                else {
                    const newPos = triggerBounds.top - elementHeight - SPACE_FROM_TOP;
                    if (newPos > 0) {
                        this.setPositionStyle('top', triggerBounds.top - elementHeight - SPACE_FROM_TOP);
                    }
                    else {
                        this.hostElement.nativeElement.style.height =
                            windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;
                        this.hostElement.nativeElement.querySelector('.popover-content').style.height =
                            windowHeight - hostTopPosition - SPACE_FROM_BOTTOM + POSITION_MEASURE_UNIT;
                    }
                }
            }
            else {
                if (this.config.type === 'context') {
                    this.setPositionStyle('top', +this.config.bounds.top + SPACE_FROM_TOP);
                }
                else {
                    this.setPositionStyle('top', triggerBounds.top + triggerBounds.height + SPACE_FROM_TOP);
                }
            }
        }
        if (!this.config.triggerDirective) {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            const hostPosition = hostBounds.top;
            if (elementHeight >= windowHeight - hostPosition - SPACE_FROM_BOTTOM) {
                const diff = elementHeight - (windowHeight - hostPosition);
                this.setPositionStyle('top', hostPosition - diff - SPACE_FROM_BOTTOM);
            }
            else {
                this.setPositionStyle('top', hostPosition);
            }
        }
    }
    setLeftPosition() {
        const windowWidth = window.innerWidth;
        const elementWidth = this.hostElement.nativeElement.getBoundingClientRect().width;
        const hostBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (this.isContextType) {
            if (+this.config.bounds.left >= windowWidth / 2) {
                this.setPositionStyle('left', +this.config.bounds.left - elementWidth);
            }
            else {
                this.setPositionStyle('left', this.defaultLeftPosition);
            }
        }
        else if (this.config.triggerDirective) {
            if (hostBounds.left >= windowWidth / 2) {
                this.setPositionStyle('left', hostBounds.right - elementWidth);
            }
            else {
                this.setPositionStyle('left', hostBounds.left);
            }
        }
        else {
            const hostBounds = this.config.submenuTriggeredItem.element.nativeElement.getBoundingClientRect();
            if (elementWidth > windowWidth - hostBounds.right) {
                this.setPositionStyle('left', hostBounds.left - this.initHostElementWidth);
            }
            else {
                this.setPositionStyle('left', hostBounds.right);
            }
        }
    }
    setWidth() {
        const triggerBounds = this.config.triggerElement.nativeElement.getBoundingClientRect();
        if (!this.isContextType && !this.isSubmenuType) {
            const windowWidth = window.innerWidth;
            const hostElBounds = this.hostElement.nativeElement.getBoundingClientRect();
            this.hostElement.nativeElement.style.minWidth = triggerBounds.width + POSITION_MEASURE_UNIT;
            if (!this.isMenuType) {
                if (hostElBounds.left < 0 || hostElBounds.right > windowWidth) {
                    this.hostElement.nativeElement.style.width = windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.hostElement.nativeElement.querySelector('.popover-content').style.minWidth =
                        windowWidth - 30 + POSITION_MEASURE_UNIT;
                    this.setPositionStyle('left', 15);
                }
            }
        }
    }
    setPositionStyle(property, value) {
        this.hostElement.nativeElement.style[property] = value + POSITION_MEASURE_UNIT;
    }
    get defaultLeftPosition() {
        return this.config.bounds.left;
    }
    get canAssignPadding() {
        return ((!this.isContextType && !this.isMenuType && !this.isSubmenuType) ||
            (this.isSubmenuType && !!this.config.content));
    }
    get isContextType() {
        return this.type === 'context';
    }
    get isMenuType() {
        return this.type === 'menu';
    }
    get isSubmenuType() {
        return this.type === 'submenu';
    }
    get isTooltip() {
        return this.type === 'tooltip';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci1zdHlsZXMubW9kZWwuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvZm9sdGkvUHJvamVjdHMvbmctcG9wcHkvcHJvamVjdHMvbmctcG9wcHkvc3JjLyIsInNvdXJjZXMiOlsibGliL3BvcG92ZXIvbW9kZWxzL3BvcG92ZXItc3R5bGVzLm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBQzdCLE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztBQUMxQixNQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQztBQUVuQyxNQUFNLE9BQU8sYUFBYTtJQU94QixZQUFZLE9BQWdDO1FBRnBDLHlCQUFvQixHQUFXLENBQUMsQ0FBQztRQUd2QyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDbkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQUk7UUFDRixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUV0QyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUVwRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsY0FBYyxDQUFDLENBQUM7UUFFbkYsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzlDLElBQUks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QUFDO0lBRUQsSUFBWSxhQUFhO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7SUFDakMsQ0FBQztJQUVELElBQVksU0FBUztRQUNuQixPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDO0lBQ2pDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBvcG92ZXJDb25maWcgfSBmcm9tICcuLi9wb3BvdmVyLnRva2VuJztcbmltcG9ydCB7IFBvcG92ZXJUeXBlIH0gZnJvbSAnLi4vcG9wb3Zlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9wb3ZlckNvbnRlbnRDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL3BvcG92ZXItY29udGVudC9wb3BvdmVyLWNvbnRlbnQuY29tcG9uZW50JztcblxuY29uc3QgU1BBQ0VfRlJPTV9CT1RUT00gPSAyMDtcbmNvbnN0IFNQQUNFX0ZST01fVE9QID0gMTA7XG5jb25zdCBQT1NJVElPTl9NRUFTVVJFX1VOSVQgPSAncHgnO1xuXG5leHBvcnQgY2xhc3MgUG9wb3ZlclN0eWxlcyB7XG4gIHByaXZhdGUgcG9wb3ZlcjogUG9wb3ZlckNvbnRlbnRDb21wb25lbnQ7XG4gIHByaXZhdGUgaG9zdEVsZW1lbnQ6IEVsZW1lbnRSZWY8YW55PjtcbiAgcHJpdmF0ZSBjb25maWc6IFBvcG92ZXJDb25maWc7XG4gIHByaXZhdGUgdHlwZTogUG9wb3ZlclR5cGU7XG4gIHByaXZhdGUgaW5pdEhvc3RFbGVtZW50V2lkdGg6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IocG9wb3ZlcjogUG9wb3ZlckNvbnRlbnRDb21wb25lbnQpIHtcbiAgICB0aGlzLnBvcG92ZXIgPSBwb3BvdmVyO1xuICAgIHRoaXMuaG9zdEVsZW1lbnQgPSBwb3BvdmVyLmVsZW1lbnQ7XG4gICAgdGhpcy5jb25maWcgPSBwb3BvdmVyLnBvcG92ZXJDb25maWc7XG4gICAgdGhpcy50eXBlID0gdGhpcy5jb25maWcudHlwZTtcbiAgfVxuXG4gIGluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgaG9zdEJvdW5kcyA9IHRoaXMuY29uZmlnLmJvdW5kcztcblxuICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS56SW5kZXggPSAxMDAwMDtcblxuICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIDApO1xuICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgK2hvc3RCb3VuZHMudG9wICsgaG9zdEJvdW5kcy5oZWlnaHQgKyBTUEFDRV9GUk9NX1RPUCk7XG5cbiAgICBpZiAoIXRoaXMuaXNDb250ZXh0VHlwZSAmJiAhdGhpcy5pc1N1Ym1lbnVUeXBlKSB7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBob3N0Qm91bmRzLndpZHRoICsgJ3B4JztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0NvbnRleHRUeXBlKSB7XG4gICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ3RvcCcsICtob3N0Qm91bmRzLnRvcCk7XG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSAwO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzU3VibWVudVR5cGUpIHtcbiAgICAgIGNvbnN0IHRyaWdnZXJJdGVtID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgY29uc3QgdHJpZ2dlckJvdW5kczogQ2xpZW50UmVjdCA9IHRyaWdnZXJJdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSAwO1xuICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FuQXNzaWduUGFkZGluZykge1xuICAgICAgY29uc3QgcGFkZGluZyA9IHRoaXMuaXNUb29sdGlwID8gJzhweCAxMnB4JyA6ICcxNXB4IDI1cHgnO1xuICAgICAgdGhpcy5wb3BvdmVyLnBvcG92ZXJXcmFwcGVyRWwubmF0aXZlRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gcGFkZGluZztcbiAgICB9XG5cbiAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmluaXRIb3N0RWxlbWVudFdpZHRoID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy5pbml0SG9zdEVsZW1lbnRXaWR0aCArICdweCc7XG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGUoKTogdm9pZCB7XG4gICAgdGhpcy5zZXRMZWZ0UG9zaXRpb24oKTtcbiAgICB0aGlzLnNldFRvcFBvc2l0aW9uKCk7XG4gICAgdGhpcy5zZXRXaWR0aCgpO1xuXG4gICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gIH1cblxuICBwcml2YXRlIHNldFRvcFBvc2l0aW9uKCk6IHZvaWQge1xuICAgIGNvbnN0IHdpbmRvd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICBjb25zdCBlbGVtZW50SGVpZ2h0ID0gdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICBjb25zdCB0cmlnZ2VyQm91bmRzID0gdGhpcy5jb25maWcudHJpZ2dlckVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy50cmlnZ2VyRGlyZWN0aXZlKSB7XG4gICAgICBjb25zdCBob3N0VG9wUG9zaXRpb24gPVxuICAgICAgICB0aGlzLmNvbmZpZy50eXBlID09PSAnY29udGV4dCcgPyB0aGlzLmNvbmZpZy5ib3VuZHMudG9wIDogdHJpZ2dlckJvdW5kcy50b3AgKyB0cmlnZ2VyQm91bmRzLmhlaWdodDtcbiAgICAgIGNvbnN0IGlzQmVsb3dXaW5kb3dDZW50ZXJIZWlnaHQgPSBlbGVtZW50SGVpZ2h0ID49IHdpbmRvd0hlaWdodCAtIGhvc3RUb3BQb3NpdGlvbiAtIFNQQUNFX0ZST01fQk9UVE9NO1xuXG4gICAgICBpZiAoaXNCZWxvd1dpbmRvd0NlbnRlckhlaWdodCkge1xuICAgICAgICBpZiAodGhpcy5jb25maWcudHlwZSA9PT0gJ2NvbnRleHQnKSB7XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCArdGhpcy5jb25maWcuYm91bmRzLnRvcCAtIGVsZW1lbnRIZWlnaHQgKyBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgbmV3UG9zID0gdHJpZ2dlckJvdW5kcy50b3AgLSBlbGVtZW50SGVpZ2h0IC0gU1BBQ0VfRlJPTV9UT1A7XG4gICAgICAgICAgaWYgKG5ld1BvcyA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgdHJpZ2dlckJvdW5kcy50b3AgLSBlbGVtZW50SGVpZ2h0IC0gU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID1cbiAgICAgICAgICAgICAgd2luZG93SGVpZ2h0IC0gaG9zdFRvcFBvc2l0aW9uIC0gU1BBQ0VfRlJPTV9CT1RUT00gKyBQT1NJVElPTl9NRUFTVVJFX1VOSVQ7XG4gICAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnBvcG92ZXItY29udGVudCcpLnN0eWxlLmhlaWdodCA9XG4gICAgICAgICAgICAgIHdpbmRvd0hlaWdodCAtIGhvc3RUb3BQb3NpdGlvbiAtIFNQQUNFX0ZST01fQk9UVE9NICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnR5cGUgPT09ICdjb250ZXh0Jykge1xuICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgK3RoaXMuY29uZmlnLmJvdW5kcy50b3AgKyBTUEFDRV9GUk9NX1RPUCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCd0b3AnLCB0cmlnZ2VyQm91bmRzLnRvcCArIHRyaWdnZXJCb3VuZHMuaGVpZ2h0ICsgU1BBQ0VfRlJPTV9UT1ApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZy50cmlnZ2VyRGlyZWN0aXZlKSB7XG4gICAgICBjb25zdCBob3N0Qm91bmRzID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgaG9zdFBvc2l0aW9uID0gaG9zdEJvdW5kcy50b3A7XG5cbiAgICAgIGlmIChlbGVtZW50SGVpZ2h0ID49IHdpbmRvd0hlaWdodCAtIGhvc3RQb3NpdGlvbiAtIFNQQUNFX0ZST01fQk9UVE9NKSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBlbGVtZW50SGVpZ2h0IC0gKHdpbmRvd0hlaWdodCAtIGhvc3RQb3NpdGlvbik7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgaG9zdFBvc2l0aW9uIC0gZGlmZiAtIFNQQUNFX0ZST01fQk9UVE9NKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgndG9wJywgaG9zdFBvc2l0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldExlZnRQb3NpdGlvbigpOiB2b2lkIHtcbiAgICBjb25zdCB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIGNvbnN0IGVsZW1lbnRXaWR0aCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICBjb25zdCBob3N0Qm91bmRzID0gdGhpcy5jb25maWcudHJpZ2dlckVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICh0aGlzLmlzQ29udGV4dFR5cGUpIHtcbiAgICAgIGlmICgrdGhpcy5jb25maWcuYm91bmRzLmxlZnQgPj0gd2luZG93V2lkdGggLyAyKSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsICt0aGlzLmNvbmZpZy5ib3VuZHMubGVmdCAtIGVsZW1lbnRXaWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCB0aGlzLmRlZmF1bHRMZWZ0UG9zaXRpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcudHJpZ2dlckRpcmVjdGl2ZSkge1xuICAgICAgaWYgKGhvc3RCb3VuZHMubGVmdCA+PSB3aW5kb3dXaWR0aCAvIDIpIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgaG9zdEJvdW5kcy5yaWdodCAtIGVsZW1lbnRXaWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCBob3N0Qm91bmRzLmxlZnQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBob3N0Qm91bmRzID0gdGhpcy5jb25maWcuc3VibWVudVRyaWdnZXJlZEl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICBpZiAoZWxlbWVudFdpZHRoID4gd2luZG93V2lkdGggLSBob3N0Qm91bmRzLnJpZ2h0KSB7XG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb25TdHlsZSgnbGVmdCcsIGhvc3RCb3VuZHMubGVmdCAtIHRoaXMuaW5pdEhvc3RFbGVtZW50V2lkdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRQb3NpdGlvblN0eWxlKCdsZWZ0JywgaG9zdEJvdW5kcy5yaWdodCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRXaWR0aCgpOiB2b2lkIHtcbiAgICBjb25zdCB0cmlnZ2VyQm91bmRzOiBDbGllbnRSZWN0ID0gdGhpcy5jb25maWcudHJpZ2dlckVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmICghdGhpcy5pc0NvbnRleHRUeXBlICYmICF0aGlzLmlzU3VibWVudVR5cGUpIHtcbiAgICAgIGNvbnN0IHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICBjb25zdCBob3N0RWxCb3VuZHMgPSB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRyaWdnZXJCb3VuZHMud2lkdGggKyBQT1NJVElPTl9NRUFTVVJFX1VOSVQ7XG5cbiAgICAgIGlmICghdGhpcy5pc01lbnVUeXBlKSB7XG4gICAgICAgIGlmIChob3N0RWxCb3VuZHMubGVmdCA8IDAgfHwgaG9zdEVsQm91bmRzLnJpZ2h0ID4gd2luZG93V2lkdGgpIHtcbiAgICAgICAgICB0aGlzLmhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSB3aW5kb3dXaWR0aCAtIDMwICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICAgICAgICAgIHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucG9wb3Zlci1jb250ZW50Jykuc3R5bGUubWluV2lkdGggPVxuICAgICAgICAgICAgd2luZG93V2lkdGggLSAzMCArIFBPU0lUSU9OX01FQVNVUkVfVU5JVDtcbiAgICAgICAgICB0aGlzLnNldFBvc2l0aW9uU3R5bGUoJ2xlZnQnLCAxNSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFBvc2l0aW9uU3R5bGUocHJvcGVydHk6ICd0b3AnIHwgJ2xlZnQnLCB2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5ob3N0RWxlbWVudC5uYXRpdmVFbGVtZW50LnN0eWxlW3Byb3BlcnR5XSA9IHZhbHVlICsgUE9TSVRJT05fTUVBU1VSRV9VTklUO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgZGVmYXVsdExlZnRQb3NpdGlvbigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5ib3VuZHMubGVmdDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGNhbkFzc2lnblBhZGRpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICghdGhpcy5pc0NvbnRleHRUeXBlICYmICF0aGlzLmlzTWVudVR5cGUgJiYgIXRoaXMuaXNTdWJtZW51VHlwZSkgfHxcbiAgICAgICh0aGlzLmlzU3VibWVudVR5cGUgJiYgISF0aGlzLmNvbmZpZy5jb250ZW50KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc0NvbnRleHRUeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09ICdjb250ZXh0JztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzTWVudVR5cGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ21lbnUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNTdWJtZW51VHlwZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSAnc3VibWVudSc7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc1Rvb2x0aXAoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudHlwZSA9PT0gJ3Rvb2x0aXAnO1xuICB9XG59XG4iXX0=